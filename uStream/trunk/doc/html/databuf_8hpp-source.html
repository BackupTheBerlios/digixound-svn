<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>uStream: C:/ustream_streaming_architecture/uOsUtil/include/core/databuf.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">ustream_streaming_architecture</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">uOsUtil</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000003.html">core</a></div>
<h1>databuf.hpp</h1><a href="databuf_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">  uSTREAM LIGHT-WEIGHT STREAMING ARCHITECTURE</span>
00003 <span class="comment">  Copyright (C) 2005 Luis Serrano (luis@kontrol-dj.com) </span>
00004 <span class="comment">  </span>
00005 <span class="comment">  Based on DANUBIO STREAMING ARCHITECTURE by Michele Iacobellis (m.iacobellis@nexotech.it)</span>
00006 <span class="comment"></span>
00007 <span class="comment">  This program is free software; you can redistribute it and/or modify</span>
00008 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00009 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00010 <span class="comment">  (at your option) any later version.</span>
00011 <span class="comment"></span>
00012 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00013 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00014 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00015 <span class="comment">  GNU General Public License for more details.</span>
00016 <span class="comment"></span>
00017 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00018 <span class="comment">  along with this program; if not, write to the Free Software</span>
00019 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00020 <span class="comment"></span>
00021 <span class="comment">*/</span>
00022 
00023 <span class="preprocessor">#ifndef DATABUF_HPP</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#define DATABUF_HPP</span>
00025 <span class="preprocessor"></span>
00026 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00027 <span class="preprocessor">#include &lt;string.h&gt;</span>
00028 
00029 <span class="preprocessor">#include "<a class="code" href="object_8hpp.html">object.hpp</a>"</span>
00030 
00031 <span class="keyword">namespace </span>uStreamLib {
00032         <span class="comment">/*</span>
00033 <span class="comment">         * Forward declaration of BufferPool.</span>
00034 <span class="comment">         */</span>
00035         <span class="keyword">class </span><a class="code" href="classu_stream_lib_1_1_buffer_pool.html">BufferPool</a>;
00036 
<a name="l00047"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html">00047</a>         <span class="keyword">class </span><a class="code" href="typedefs_8hpp.html#a7">US_API_EXPORT</a> DataBuf : <span class="keyword">public</span> <a class="code" href="classu_stream_lib_1_1_object.html">Object</a> {
00048         <span class="keyword">public</span>:
00049                 <span class="comment">/*</span>
00050 <span class="comment">                 * Friend classes.</span>
00051 <span class="comment">                 */</span>
<a name="l00052"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#n0">00052</a>                 <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classu_stream_lib_1_1_buffer_pool.html">BufferPool</a>;
00053 
<a name="l00060"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#w2">00060</a>                 <span class="keyword">enum</span> AllocStrategy { 
00065                 ALLOC_ONCREATE = 1,
00071                 ALLOC_ONUSE = 2 };
00072 
00076                 DataBuf(<span class="keywordtype">void</span>);
00077 
00081                 <span class="keyword">virtual</span> ~DataBuf(<span class="keywordtype">void</span>);
00082 
00095                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> init(uint32 size, uint32 bid = 0, uint32 limit = 65536,
00096                         AllocStrategy strategy = ALLOC_ONCREATE, <a class="code" href="classu_stream_lib_1_1_buffer_pool.html">BufferPool</a>* bp = NULL);
00097 
00104                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> init(<span class="keywordtype">char</span>* string);
00105 
00110                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> init(DataBuf&amp; db);
00111 
<a name="l00116"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a5">00116</a>                 <a class="code" href="classu_stream_lib_1_1_buffer_pool.html">BufferPool</a>* getBufferPool(<span class="keywordtype">void</span>)
00117                 {
00118                         <span class="keywordflow">return</span> m_pbpParent;
00119                 }
00120 
<a name="l00124"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a6">00124</a>                 <span class="keywordtype">bool</span> isInUse(<span class="keywordtype">void</span>)
00125                 {
00126                         <span class="keywordflow">return</span> m_bInUse;
00127                 }
00128 
<a name="l00132"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a7">00132</a>                 <span class="keywordtype">void</span> setInUse(<span class="keywordtype">bool</span> value)
00133                 {
00134                         m_bInUse = value;
00135                 }
00136 
<a name="l00140"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a8">00140</a>                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> getBID(<span class="keywordtype">void</span>)
00141                 {
00142                         <span class="keywordflow">return</span> m_uBID;
00143                 }
00144 
<a name="l00148"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a9">00148</a>                 <span class="keywordtype">void</span> setBID(uint32 <span class="keywordtype">id</span>)
00149                 {
00150                         m_uBID = id;
00151                 }
00152 
<a name="l00156"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a10">00156</a>                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> getSize(<span class="keywordtype">void</span>)
00157                 {
00158                         <span class="keywordflow">return</span> m_uSize;
00159                 }
00160 
<a name="l00164"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a11">00164</a>                 <span class="keywordtype">void</span> setLimit(uint32 value)
00165                 {
00166                         m_uLimit = value;
00167                 }
00168 
<a name="l00172"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a12">00172</a>                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> getLimit(<span class="keywordtype">void</span>)
00173                 {
00174                         <span class="keywordflow">return</span> m_uLimit;
00175                 }
00176 
<a name="l00185"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a13">00185</a>                 <span class="keywordtype">void</span>* getAddr(<span class="keywordtype">void</span>)
00186                 {
00187                         <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *) m_strBlock;
00188                 }
00189 
<a name="l00193"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a14">00193</a>                 <span class="keywordtype">char</span>* operator[](uint32 pos)
00194                 {
00195                         <span class="keywordflow">if</span> (!m_strBlock)
00196                                 <span class="keywordflow">return</span> NULL;
00197                         <span class="keywordflow">if</span> (pos &gt;= m_uSize)
00198                                 <span class="keywordflow">return</span> NULL;
00199 
00200                         <span class="keywordflow">return</span> &amp;m_strBlock[pos];
00201                 }
00202 
<a name="l00208"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">00208</a>                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> getCount(<span class="keywordtype">void</span>)
00209                 {
00210                         <span class="keywordflow">return</span> m_uCount;
00211                 }
00212 
<a name="l00220"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a16">00220</a>                 <span class="keywordtype">void</span> setCount(uint32 count)
00221                 {
00222                         <span class="keywordflow">if</span> (count &lt;= m_uSize)
00223                                 m_uCount = count;
00224                         <span class="keywordflow">else</span>
00225                                 m_uCount = m_uSize;
00226                 }
00227 
00234                 <span class="keywordtype">void</span> copy(<span class="keywordtype">char</span>* data, uint32 size);
00235 
<a name="l00240"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a18">00240</a>                 <span class="keywordtype">void</span> copy(<span class="keywordtype">char</span>* string)
00241                 {
00242                         copy(string, (<a class="code" href="namespaceu_stream_lib.html#a243">uint32</a>) strlen(string) + 1);
00243                 }
00244 
<a name="l00250"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a19">00250</a>                 <span class="keywordtype">void</span> copy(DataBuf* b)
00251                 {
00252                         copy((<span class="keywordtype">char</span> *) b-&gt;<a class="code" href="classu_stream_lib_1_1_data_buf.html#a13">getAddr</a>(), b-&gt;<a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">getCount</a>());
00253                 }
00254 
00261                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> xcopy(<span class="keywordtype">char</span>* data, uint32 size);
00262 
<a name="l00269"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a21">00269</a>                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> xcopy(<span class="keywordtype">char</span>* string)
00270                 {
00271                         <span class="keywordflow">return</span> xcopy(string, (<a class="code" href="namespaceu_stream_lib.html#a243">uint32</a>) strlen(string) + 1);
00272                 }
00273 
<a name="l00280"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a22">00280</a>                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> xcopy(DataBuf* b)
00281                 {
00282                         <span class="keywordflow">return</span> xcopy((<span class="keywordtype">char</span> *) b-&gt;<a class="code" href="classu_stream_lib_1_1_data_buf.html#a13">getAddr</a>(), b-&gt;<a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">getCount</a>());
00283                 }
00284 
00290                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> merge(<span class="keywordtype">char</span>* data, uint32 size);
00291 
<a name="l00298"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a24">00298</a>                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> merge(<span class="keywordtype">char</span>* string)
00299                 {
00300                         <span class="keywordflow">return</span> merge(string, (<a class="code" href="namespaceu_stream_lib.html#a243">uint32</a>) strlen(string));
00301                 }
00302 
<a name="l00309"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a25">00309</a>                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> merge(DataBuf* b)
00310                 {
00311                         <span class="keywordflow">return</span> merge((<span class="keywordtype">char</span> *) b-&gt;<a class="code" href="classu_stream_lib_1_1_data_buf.html#a13">getAddr</a>(), b-&gt;<a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">getCount</a>());
00312                 }
00313 
00322                 <span class="keywordtype">void</span> move(int32 to, int32 from, uint32 size);
00323 
00331                 <span class="keywordtype">void</span> moveOnStart(int32 from, uint32 size);
00332 
00338                 <span class="keywordtype">void</span> set(int32 c);
00339 
00345                 <span class="keywordtype">void</span> set(uint32 offset, int32 c);
00346 
00353                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> realloc(uint32 size);
00354 
00358                 <span class="keywordtype">void</span> printHex(<span class="keywordtype">void</span>);
00359 
<a name="l00368"></a><a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">00368</a>                 <span class="keywordtype">char</span>* toString(<span class="keywordtype">void</span>)
00369                 {
00370                         <span class="keywordflow">return</span> m_strBlock;
00371                 }
00372         <span class="keyword">private</span>:
00373                 <span class="comment">/* no copy constructor available */</span>
00374                 DataBuf(DataBuf&amp; db)
00375                         : <a class="code" href="classu_stream_lib_1_1_object.html">Object</a>(db)
00376                 {
00377                 }
00378 
00379                 <span class="comment">/* pointer to the parent buffer pool */</span>
00380                 <a class="code" href="classu_stream_lib_1_1_buffer_pool.html">BufferPool</a>* m_pbpParent;
00381 
00382                 <span class="comment">/* numeric identifier */</span>
00383                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> m_uBID;
00384 
00385                 <span class="comment">/* ptr to a memory chunk */</span>
00386                 <span class="keywordtype">char</span>* m_strBlock;
00387 
00388                 <span class="comment">/* size of the buffer */</span>
00389                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> m_uSize;
00390 
00391                 <span class="comment">/* valid items count in the buffer */</span>
00392                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> m_uCount;
00393 
00394                 <span class="comment">/* buffer size limit */</span>
00395                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> m_uLimit;
00396 
00397                 <span class="comment">/* flag: in use */</span>
00398                 <span class="keywordtype">bool</span> m_bInUse;
00399 
00400                 <span class="comment">/* memory allocation strategy */</span>
00401                 AllocStrategy m_asStrategy;
00402         };
00403 }
00404 
00405 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Feb 9 19:03:30 2006 for uStream by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
