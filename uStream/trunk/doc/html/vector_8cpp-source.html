<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>uStream: C:/ustream_streaming_architecture/uOsUtil/src/core/vector.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">ustream_streaming_architecture</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">uOsUtil</a>&nbsp;/&nbsp;<a class="el" href="dir_000006.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000007.html">core</a></div>
<h1>vector.cpp</h1><a href="vector_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">  uSTREAM LIGHT-WEIGHT STREAMING ARCHITECTURE</span>
00003 <span class="comment">  Copyright (C) 2005 Luis Serrano (luis@kontrol-dj.com) </span>
00004 <span class="comment">  </span>
00005 <span class="comment">  Based on DANUBIO STREAMING ARCHITECTURE by Michele Iacobellis (m.iacobellis@nexotech.it)</span>
00006 <span class="comment"></span>
00007 <span class="comment">  This program is free software; you can redistribute it and/or modify</span>
00008 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00009 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00010 <span class="comment">  (at your option) any later version.</span>
00011 <span class="comment"></span>
00012 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00013 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00014 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00015 <span class="comment">  GNU General Public License for more details.</span>
00016 <span class="comment"></span>
00017 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00018 <span class="comment">  along with this program; if not, write to the Free Software</span>
00019 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00020 <span class="comment"></span>
00021 <span class="comment">*/</span>
00022 
00023 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00024 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00025 <span class="preprocessor">#include &lt;string.h&gt;</span>
00026 <span class="preprocessor">#include &lt;malloc.h&gt;</span>
00027 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
00028 
00029 <span class="preprocessor">#include "<a class="code" href="vector_8hpp.html">vector.hpp</a>"</span>
00030 <span class="preprocessor">#include "<a class="code" href="databuf_8hpp.html">databuf.hpp</a>"</span>
00031 
00032 <span class="keyword">namespace </span>uStreamLib {
00033         <span class="comment">/*</span>
00034 <span class="comment">         * Vector item structure.</span>
00035 <span class="comment">         */</span>
00036 
<a name="l00037"></a><a class="code" href="structu_stream_lib_1_1_vector_slot.html">00037</a>         <span class="keyword">struct </span><a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a> {
00038                 <span class="comment">/* constructor */</span>
<a name="l00039"></a><a class="code" href="structu_stream_lib_1_1_vector_slot.html#a0">00039</a>                 <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>(<span class="keywordtype">void</span>)
00040                 {
00041                         bEmpty = <span class="keyword">true</span>;
00042                 }
00043 
00044                 <span class="comment">/* container buffer */</span>
<a name="l00045"></a><a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">00045</a>                 <a class="code" href="classu_stream_lib_1_1_data_buf.html">DataBuf</a> dbData;
00046 
00047                 <span class="comment">/* flag: the slot is empty */</span>
<a name="l00048"></a><a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">00048</a>                 <span class="keywordtype">bool</span> bEmpty;
00049         };
00050 
00051         <span class="comment">/*</span>
00052 <span class="comment">         * Vector implementation.</span>
00053 <span class="comment">         */</span>
00054 
<a name="l00055"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a0">00055</a>         Vector::Vector(<span class="keywordtype">void</span>)
00056                 : <a class="code" href="classu_stream_lib_1_1_object.html">Object</a>(<a class="code" href="namespaceu_stream_lib.html#a262a209">UOSUTIL_RTTI_VECTOR</a>), m_bSorted(false), m_comp(NULL),
00057                 m_uCount(0)
00058         {
00059                 <span class="comment">// nothing to do</span>
00060         }
00061 
<a name="l00062"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a1">00062</a>         Vector::~Vector(<span class="keywordtype">void</span>)
00063         {
00064                 <span class="keywordflow">for</span> (<a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> j = 0; j &lt; m_pvDB.<a class="code" href="classu_stream_lib_1_1_p_vector_unsafe.html#a9">getCount</a>(); j++) {
00065                         <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[j];
00066                         <span class="keywordflow">if</span> (vs)
00067                                 <span class="keyword">delete</span> vs;
00068                 }
00069 
00070                 m_uCount = 0;
00071                 m_comp = NULL;
00072         }
00073 
<a name="l00074"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a2">00074</a>         <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> Vector::init(uint32 isize, uint32 cap, uint32 incr)
00075         {
00076                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> ret = 0;
00077 
00078                 <span class="comment">// initialize main container</span>
00079                 ret = m_pvDB.<a class="code" href="classu_stream_lib_1_1_p_vector_unsafe.html#a2">init</a>(cap, incr);
00080                 <span class="keywordflow">if</span> (ret == FAILURE)
00081                         <span class="keywordflow">return</span> FAILURE;
00082 
00083                 <span class="comment">// initialize enumeration object</span>
00084                 ret = m_enValues.<a class="code" href="classu_stream_lib_1_1_enumeration.html#a2">init</a>(cap + incr);
00085                 <span class="keywordflow">if</span> (ret == FAILURE)
00086                         <span class="keywordflow">return</span> FAILURE;
00087 
00088                 <span class="comment">// initialize work buffer</span>
00089                 ret = m_dbWork.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a2">init</a>(4096, 0, 64000000, DataBuf::ALLOC_ONUSE);
00090                 <span class="keywordflow">if</span> (ret == FAILURE)
00091                         <span class="keywordflow">return</span> FAILURE;
00092 
00093                 <span class="comment">// preallocate buffers</span>
00094                 <span class="keywordflow">for</span> (<a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> j = 0; j &lt; cap; j++) {
00095                         <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = <span class="keyword">new</span> <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>();
00096                         <span class="keywordflow">if</span> (!vs)
00097                                 <span class="keywordflow">return</span> FAILURE;
00098 
00099                         ret = vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a2">init</a>(isize, 0, 65536, DataBuf::ALLOC_ONUSE);
00100                         <span class="keywordflow">if</span> (ret == FAILURE) {
00101                                 <span class="keyword">delete</span> vs; <span class="keywordflow">return</span> FAILURE;
00102                         }
00103 
00104                         ret = m_pvDB.<a class="code" href="classu_stream_lib_1_1_p_vector_unsafe.html#a3">add</a>(vs);
00105                         <span class="keywordflow">if</span> (ret == FAILURE) {
00106                                 <span class="keyword">delete</span> vs; <span class="keywordflow">return</span> FAILURE;
00107                         }
00108                 }
00109 
00110                 <span class="comment">// reset member variables</span>
00111                 m_bSorted = <span class="keyword">false</span>;
00112                 m_comp = NULL;
00113                 m_uCount = 0;
00114 
00115                 <span class="comment">// ok</span>
00116                 <span class="keywordflow">return</span> SUCCESS;
00117         }
00118 
<a name="l00119"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a3">00119</a>         <span class="keywordtype">bool</span> Vector::isSorted(<span class="keywordtype">void</span>)
00120         {
00121                 <span class="keywordflow">return</span> m_bSorted;
00122         }
00123 
<a name="l00124"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a4">00124</a>         <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> Vector::sort(<a class="code" href="classu_stream_lib_1_1_comparator.html">Comparator</a>* comp)
00125         {
00126                 <a class="code" href="classu_stream_lib_1_1_comparator.html">Comparator</a>* cUse = NULL;
00127 
00128                 <span class="keywordflow">if</span> (!m_uCount)
00129                         <span class="keywordflow">return</span> FAILURE;
00130                 <span class="keywordflow">if</span> (!comp &amp;&amp; !m_comp)
00131                         <span class="keywordflow">return</span> FAILURE;
00132 
00133                 <span class="keywordflow">if</span> (comp)
00134                         cUse = comp;
00135                 <span class="keywordflow">else</span>
00136                         cUse = m_comp;
00137 
00138                 _quickSort(0, m_uCount - 1, cUse);
00139 
00140                 <span class="keywordflow">if</span> (!m_comp)
00141                         m_comp = comp;
00142                 m_bSorted = <span class="keyword">true</span>;
00143 
00144                 <span class="keywordflow">return</span> SUCCESS;
00145         }
00146 
<a name="l00147"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a10">00147</a>         <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> Vector::addElement(<span class="keywordtype">char</span>* element, uint32 sz)
00148         {
00149                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> ret = 0;
00150 
00151                 <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[m_uCount];
00152                 <span class="keywordflow">if</span> (!vs) {
00153                         vs = <span class="keyword">new</span> <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>();
00154                         <span class="keywordflow">if</span> (!vs)
00155                                 <span class="keywordflow">return</span> FAILURE;
00156 
00157                         ret = vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a2">init</a>(sz, 0, 65536, DataBuf::ALLOC_ONUSE);
00158                         <span class="keywordflow">if</span> (ret == FAILURE) {
00159                                 <span class="keyword">delete</span> vs; <span class="keywordflow">return</span> FAILURE;
00160                         }
00161 
00162                         ret = m_pvDB.<a class="code" href="classu_stream_lib_1_1_p_vector_unsafe.html#a3">add</a>(vs);
00163                         <span class="keywordflow">if</span> (ret == FAILURE) {
00164                                 <span class="keyword">delete</span> vs; <span class="keywordflow">return</span> FAILURE;
00165                         }
00166                 }
00167 
00168                 vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">bEmpty</a> = <span class="keyword">false</span>;
00169                 ret = vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a20">xcopy</a>(element, sz);
00170                 <span class="keywordflow">if</span> (ret == FAILURE)
00171                         <span class="keywordflow">return</span> FAILURE;
00172 
00173                 <span class="keywordflow">if</span> (m_bSorted &amp;&amp; m_comp)
00174                         <a class="code" href="classu_stream_lib_1_1_vector.html#a4">sort</a>(m_comp);
00175 
00176                 m_uCount += 1;
00177                 <span class="keywordflow">return</span> SUCCESS;
00178         }
00179 
<a name="l00180"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a9">00180</a>         <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> Vector::addElements(<span class="keywordtype">char</span>* elements, <span class="keywordtype">char</span>* separator, <span class="keywordtype">bool</span> trim)
00181         {
00182                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> token_found = 0;
00183                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> i = 0, k = 0;
00184 
00185                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> strsz = (int32) strlen(elements) + 1;
00186                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> ret = 0;
00187 
00188                 <span class="keywordtype">char</span>* in = elements;
00189                 <span class="keywordtype">char</span>* token = NULL, * temp = NULL;
00190                 <span class="keywordtype">char</span>* first = NULL, * ttemp = NULL;
00191 
00192                 <span class="keywordtype">char</span>* sep = separator, * sep_cur = sep;
00193                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> sepsz = (int32) strlen( separator) + 1, sep_i = 0;
00194 
00195                 <span class="keywordtype">bool</span> bSorted = m_bSorted;
00196                 m_bSorted = <span class="keyword">false</span>;
00197 
00198                 m_dbWork.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a16">setCount</a>(0);
00199 
00200                 ret = m_dbWork.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a30">realloc</a>(strsz);
00201                 <span class="keywordflow">if</span> (ret == FAILURE)
00202                         <span class="keywordflow">return</span> FAILURE;
00203 
00204                 temp = m_dbWork.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">toString</a>();
00205                 first = m_dbWork.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">toString</a>();
00206 
00207                 <span class="comment">// printf("sepsz = %d, sep = \"%s\"\n",sepsz,sep);</span>
00208 
00209                 <span class="keywordflow">while</span> (i &lt; strsz &amp;&amp; *in) {
00210                         *temp = *in;
00211 
00212                         <span class="keywordflow">if</span> (*in == <span class="charliteral">'\"'</span>) {
00213                                 temp = first;
00214 
00215                                 <span class="keywordflow">while</span> (++i &lt; strsz &amp;&amp; *(++in) != <span class="charliteral">'\"'</span>) {
00216                                         *temp = *in; temp++;
00217                                 }
00218 
00219                                 *temp = <span class="charliteral">'\0'</span>;
00220                                 token_found = 1;
00221                                 temp = first;
00222 
00223                                 in++;
00224                                 i++;
00225                         } <span class="keywordflow">else</span> {
00226                                 <span class="keywordflow">while</span> (*in &amp;&amp; *sep_cur &amp;&amp; *in == *sep_cur) {
00227                                         <span class="comment">// printf("FOUND %d-th char of %s\n",sep_i,sep);</span>
00228 
00229                                         sep_cur++;
00230                                         sep_i++;
00231 
00232                                         temp++;
00233                                         in++;
00234                                         i++;
00235 
00236                                         *temp = *in;
00237                                 }
00238 
00239                                 <span class="keywordflow">if</span> (*in == <span class="charliteral">'\0'</span> || *sep_cur == <span class="charliteral">'\0'</span> || sep_i == sepsz - 1) {
00240                                         <span class="comment">// printf("FOUND SEPARATOR OR END OF INPUT\n");</span>
00241 
00242                                         *(temp - sep_i) = <span class="charliteral">'\0'</span>;
00243                                         temp = first;
00244                                         sep_cur = sep;
00245                                         sep_i = 0;
00246                                         token_found = 1;
00247                                 } <span class="keywordflow">else</span> {
00248                                         temp++;
00249                                         in++;
00250                                         i++;
00251                                 }
00252                         }
00253 
00254                         <span class="keywordflow">if</span> (*in == <span class="charliteral">'\0'</span>) {
00255                                 <span class="comment">// printf("FOUND END OF INPUT\n");</span>
00256 
00257                                 <span class="keywordflow">if</span> (temp != first)
00258                                         *temp = <span class="charliteral">'\0'</span>;
00259 
00260                                 temp = first;
00261                                 sep_cur = sep;
00262                                 sep_i = 0;
00263                                 token_found = 1;
00264                         }
00265 
00266                         <span class="keywordflow">if</span> (token_found) {
00267                                 token = temp;
00268 
00269                                 k = (int32) strlen(token);
00270                                 <span class="keywordflow">while</span> (k &amp;&amp; isspace(toascii(*token))) {
00271                                         token++; k--;
00272                                 }
00273 
00274                                 k = (int32) strlen(token);
00275                                 ttemp = &amp;token[k];
00276                                 <span class="keywordflow">while</span> (k &amp;&amp;
00277                                         (isspace(toascii(*ttemp)) || iscntrl(toascii(*ttemp)))) {
00278                                         *ttemp = 0; ttemp--;
00279                                 }
00280 
00281                                 <span class="comment">// printf("token = -&gt;\"%s\"&lt;-\n",token);</span>
00282 
00283                                 <span class="keywordflow">if</span> (*token) {
00284                                         ret = <a class="code" href="classu_stream_lib_1_1_vector.html#a10">addElement</a>(token);
00285                                         <span class="keywordflow">if</span> (ret == FAILURE)
00286                                                 <span class="keywordflow">return</span> FAILURE;
00287                                 }
00288 
00289                                 token_found = 0;
00290                         }
00291                 }
00292 
00293                 m_bSorted = bSorted;
00294                 <span class="keywordflow">if</span> (m_bSorted &amp;&amp; m_comp)
00295                         <a class="code" href="classu_stream_lib_1_1_vector.html#a4">sort</a>(m_comp);
00296 
00297                 <span class="keywordflow">return</span> SUCCESS;
00298         }
00299 
<a name="l00300"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a12">00300</a>         <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> Vector::setElementAt(uint32 idx, <span class="keywordtype">char</span>* item, uint32 sz)
00301         {
00302                 <span class="keywordflow">if</span> (idx &gt;= m_uCount)
00303                         <span class="keywordflow">return</span> FAILURE;
00304 
00305                 <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[idx];
00306                 <span class="keywordflow">if</span> (vs) {
00307                         vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">bEmpty</a> = <span class="keyword">false</span>;
00308                         <span class="keywordflow">return</span> vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a20">xcopy</a>(item, sz);
00309                 }
00310 
00311                 <span class="keywordflow">if</span> (m_bSorted &amp;&amp; m_comp)
00312                         <a class="code" href="classu_stream_lib_1_1_vector.html#a4">sort</a>(m_comp);
00313 
00314                 <span class="keywordflow">return</span> FAILURE;
00315         }
00316 
<a name="l00317"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a19">00317</a>         <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> Vector::scan(<span class="keywordtype">char</span>* key, uint32 sz, uint32* index, <a class="code" href="classu_stream_lib_1_1_comparator.html">Comparator</a>* c)
00318         {
00319                 <a class="code" href="classu_stream_lib_1_1_comparator.html">Comparator</a>* cUse = NULL;
00320                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> ret = 0;
00321 
00322                 <span class="keywordflow">if</span> (!c &amp;&amp; !m_comp)
00323                         <span class="keywordflow">return</span> FAILURE;
00324 
00325                 <span class="keywordflow">if</span> (!c)
00326                         cUse = m_comp;
00327                 <span class="keywordflow">else</span>
00328                         cUse = c;
00329 
00330                 <span class="keywordflow">for</span> (<a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> j = 0; j &lt; <a class="code" href="classu_stream_lib_1_1_vector.html#a23">getCount</a>(); j++) {
00331                         <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[j];
00332                         <span class="keywordflow">if</span> (vs) {
00333                                 ret = cUse-&gt;<a class="code" href="classu_stream_lib_1_1_comparator.html#a2">compare</a>(vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">toString</a>(),
00334                                                                 vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">getCount</a>(), key, sz);
00335                                 <span class="keywordflow">if</span> (ret == SUCCESS) {
00336                                         <span class="keywordflow">if</span> (index)
00337                                                 *index = j;
00338                                         <span class="keywordflow">return</span> SUCCESS;
00339                                 }
00340                         }
00341                 }
00342 
00343                 <span class="keywordflow">return</span> FAILURE;
00344         }
00345 
<a name="l00346"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a5">00346</a>         <span class="keywordtype">char</span>* Vector::search(<span class="keywordtype">char</span>* key, uint32 sz, <a class="code" href="classu_stream_lib_1_1_comparator.html">Comparator</a>* c)
00347         {
00348                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> index = 0;
00349 
00350                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> ret = <a class="code" href="classu_stream_lib_1_1_vector.html#a19">scan</a>(key, sz, &amp;index, c);
00351                 <span class="keywordflow">if</span> (ret == FAILURE)
00352                         <span class="keywordflow">return</span> NULL;
00353 
00354                 <span class="keywordflow">return</span> (*this)[index];
00355         }
00356 
<a name="l00357"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a15">00357</a>         <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> Vector::removeElement(<span class="keywordtype">char</span>* element, uint32 sz, <a class="code" href="classu_stream_lib_1_1_comparator.html">Comparator</a>* c)
00358         {
00359                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> index = 0;
00360 
00361                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> ret = <a class="code" href="classu_stream_lib_1_1_vector.html#a19">scan</a>(element, sz, &amp;index, c);
00362                 <span class="keywordflow">if</span> (ret == FAILURE)
00363                         <span class="keywordflow">return</span> FAILURE;
00364 
00365                 <span class="keywordflow">return</span> <a class="code" href="classu_stream_lib_1_1_vector.html#a14">removeElementAt</a>(index);
00366         }
00367 
<a name="l00368"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a14">00368</a>         <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> Vector::removeElementAt(uint32 idx)
00369         {
00370                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> ret = 0;
00371 
00372                 <span class="keywordflow">if</span> (idx &gt;= m_uCount)
00373                         <span class="keywordflow">return</span> FAILURE;
00374 
00375                 <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[idx];
00376                 <span class="keywordflow">if</span> (vs) {
00377                         <span class="keyword">delete</span> vs;
00378 
00379                         ret = m_pvDB.<a class="code" href="classu_stream_lib_1_1_p_vector_unsafe.html#a4">del</a>(idx);
00380                         <span class="keywordflow">if</span> (ret == FAILURE)
00381                                 <span class="keywordflow">return</span> FAILURE;
00382 
00383                         m_uCount -= 1;
00384                         <span class="keywordflow">return</span> SUCCESS;
00385                 }
00386 
00387                 <span class="keywordflow">return</span> FAILURE;
00388         }
00389 
<a name="l00390"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a17">00390</a>         <span class="keywordtype">void</span> Vector::removeAll(<span class="keywordtype">void</span>)
00391         {
00392                 <span class="keywordflow">for</span> (<a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> j = 0; j &lt; m_uCount; j++) {
00393                         <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[j];
00394                         <span class="keywordflow">if</span> (vs) {
00395                                 vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">bEmpty</a> = <span class="keyword">true</span>;
00396                                 vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a16">setCount</a>(0);
00397                         }
00398                 }
00399 
00400                 m_uCount = 0;
00401         }
00402 
<a name="l00403"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a18">00403</a>         <span class="keywordtype">void</span> Vector::removeLast(<span class="keywordtype">void</span>)
00404         {
00405                 <a class="code" href="classu_stream_lib_1_1_vector.html#a14">removeElementAt</a>(<a class="code" href="classu_stream_lib_1_1_vector.html#a23">getCount</a>() - 1);
00406         }
00407 
<a name="l00408"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a7">00408</a>         <span class="keywordtype">char</span>* Vector::operator[](uint32 idx)
00409         {
00410                 <span class="keywordflow">if</span> (idx &gt;= m_uCount)
00411                         <span class="keywordflow">return</span> NULL;
00412 
00413                 <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[idx];
00414                 <span class="keywordflow">if</span> (vs &amp;&amp; !vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">bEmpty</a>)
00415                         <span class="keywordflow">return</span> vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">toString</a>();
00416 
00417                 <span class="keywordflow">return</span> NULL;
00418         }
00419 
<a name="l00420"></a><a class="code" href="classu_stream_lib_1_1_vector.html#a8">00420</a>         <a class="code" href="classu_stream_lib_1_1_enumeration.html">Enumeration</a>* Vector::elements(<span class="keywordtype">void</span>)
00421         {
00422                 m_enValues.<a class="code" href="classu_stream_lib_1_1_enumeration.html#a7">clear</a>();
00423 
00424                 <span class="keywordflow">for</span> (<a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> i = 0; i &lt; <a class="code" href="classu_stream_lib_1_1_vector.html#a23">getCount</a>(); i++) {
00425                         <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vs = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[i];
00426                         <span class="keywordflow">if</span> (vs &amp;&amp; !vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">bEmpty</a>) {
00427                                 m_enValues.<a class="code" href="classu_stream_lib_1_1_enumeration.html#a10">addElement</a>(vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">toString</a>(),
00428                                                         vs-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">getCount</a>());
00429                         }
00430                 }
00431 
00432                 m_enValues.<a class="code" href="classu_stream_lib_1_1_enumeration.html#a6">rewind</a>();
00433                 <span class="keywordflow">return</span> &amp;m_enValues;
00434         }
00435 
00436         <span class="keywordtype">void</span> Vector::_quickSort(int32 s, int32 d, <a class="code" href="classu_stream_lib_1_1_comparator.html">Comparator</a>* c)
00437         {
00438                 div_t pos = div(s + d, 2);
00439                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> ret = 0;
00440 
00441                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> i = s;
00442                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> j = d;
00443 
00444                 <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vsX = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>*) m_pvDB[pos.quot];
00445                 <span class="keywordflow">if</span> (!vsX || (vsX &amp;&amp; vsX-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">bEmpty</a>))
00446                         <span class="keywordflow">return</span>;
00447 
00448                 <span class="keywordtype">char</span>* strX = vsX-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">toString</a>();
00449                 <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> x_sz = vsX-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">getCount</a>();
00450 
00451                 <span class="keywordflow">do</span> {
00452                         <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vsI = NULL;
00453                         <a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a>* vsJ = NULL;
00454 
00455                         <span class="keywordtype">char</span>* strI = NULL;
00456                         <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> i_sz = 0;
00457 
00458                         <span class="keywordtype">char</span>* strJ = NULL;
00459                         <a class="code" href="namespaceu_stream_lib.html#a243">uint32</a> j_sz = 0;
00460 
00461                         <span class="keywordflow">while</span> (1) {
00462                                 vsI = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a> *) m_pvDB[i];
00463                                 <span class="keywordflow">if</span> (vsI &amp;&amp; !vsI-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">bEmpty</a>) {
00464                                         strI = vsI-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">toString</a>();
00465                                         i_sz = vsI-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">getCount</a>();
00466 
00467                                         ret = c-&gt;<a class="code" href="classu_stream_lib_1_1_comparator.html#a2">compare</a>(strI, i_sz, strX, x_sz);
00468                                         <span class="keywordflow">if</span> (ret &gt;= 0)
00469                                                 <span class="keywordflow">break</span>;
00470                                 }
00471 
00472                                 i++;
00473                         }
00474 
00475                         <span class="keywordflow">while</span> (1) {
00476                                 vsJ = (<a class="code" href="structu_stream_lib_1_1_vector_slot.html">VectorSlot</a> *) m_pvDB[j];
00477                                 <span class="keywordflow">if</span> (vsJ &amp;&amp; !vsJ-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o1">bEmpty</a>) {
00478                                         strJ = vsJ-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a32">toString</a>();
00479                                         j_sz = vsJ-&gt;<a class="code" href="structu_stream_lib_1_1_vector_slot.html#o0">dbData</a>.<a class="code" href="classu_stream_lib_1_1_data_buf.html#a15">getCount</a>();
00480 
00481                                         ret = c-&gt;<a class="code" href="classu_stream_lib_1_1_comparator.html#a2">compare</a>(strX, x_sz, strJ, j_sz);
00482                                         <span class="keywordflow">if</span> (ret &gt;= 0)
00483                                                 <span class="keywordflow">break</span>;
00484                                 }
00485 
00486                                 j--;
00487                         }
00488 
00489                         <span class="keywordflow">if</span> (i &lt;= j) {
00490                                 m_pvDB.<a class="code" href="classu_stream_lib_1_1_p_vector_unsafe.html#a5">set</a>(i, vsJ);
00491                                 m_pvDB.<a class="code" href="classu_stream_lib_1_1_p_vector_unsafe.html#a5">set</a>(j, vsI);
00492 
00493                                 i++;
00494                                 j--;
00495                         }
00496                 } <span class="keywordflow">while</span> (i &lt;= j);
00497 
00498                 <span class="keywordflow">if</span> (s &lt; j)
00499                         _quickSort(s, j, c);
00500                 <span class="keywordflow">if</span> (i &lt; d)
00501                         _quickSort(i, d, c);
00502         }
00503 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Feb 9 19:03:32 2006 for uStream by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
