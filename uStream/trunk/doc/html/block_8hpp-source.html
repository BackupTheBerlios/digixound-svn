<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>uStream: C:/ustream_streaming_architecture/uStream/include/block.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">ustream_streaming_architecture</a>&nbsp;/&nbsp;<a class="el" href="dir_000010.html">uStream</a>&nbsp;/&nbsp;<a class="el" href="dir_000011.html">include</a></div>
<h1>block.hpp</h1><a href="block_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">  uSTREAM LIGHT-WEIGHT STREAMING ARCHITECTURE</span>
00003 <span class="comment">  Copyright (C) 2005 Luis Serrano (luis@kontrol-dj.com) </span>
00004 <span class="comment">  </span>
00005 <span class="comment">  Based on DANUBIO STREAMING ARCHITECTURE by Michele Iacobellis (m.iacobellis@nexotech.it)</span>
00006 <span class="comment"></span>
00007 <span class="comment">  This program is free software; you can redistribute it and/or modify</span>
00008 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00009 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00010 <span class="comment">  (at your option) any later version.</span>
00011 <span class="comment"></span>
00012 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00013 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00014 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00015 <span class="comment">  GNU General Public License for more details.</span>
00016 <span class="comment"></span>
00017 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00018 <span class="comment">  along with this program; if not, write to the Free Software</span>
00019 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00020 <span class="comment">*/</span>
00021 
00022 <span class="preprocessor">#ifndef BLOCK_HPP</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define BLOCK_HPP</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#include "<a class="code" href="thread_8hpp.html">thread.hpp</a>"</span>
00026 <span class="preprocessor">#include "<a class="code" href="shared__hash_8hpp.html">shared_hash.hpp</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="sharedvars_8hpp.html">sharedvars.hpp</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="configtable_8hpp.html">configtable.hpp</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="interp_8hpp.html">interp.hpp</a>"</span>
00030 <span class="preprocessor">#include "<a class="code" href="block__handler_8hpp.html">block_handler.hpp</a>"</span>
00031 <span class="preprocessor">#include "<a class="code" href="default__status__listener_8hpp.html">default_status_listener.hpp</a>"</span>
00032 
00033 <span class="keyword">namespace </span>uStreamLib {
00034         <span class="comment">/* declares block manager */</span>
00035         <span class="keyword">class </span><a class="code" href="classu_stream_lib_1_1_block_manager.html">BlockManager</a>;
00036 
<a name="l00047"></a><a class="code" href="classu_stream_lib_1_1_block.html">00047</a>         <span class="keyword">class </span><a class="code" href="constants_8hpp.html#a0">US_EXPORT</a> Block : <span class="keyword">public</span> <a class="code" href="classu_stream_lib_1_1_thread.html">Thread</a>, <span class="keyword">public</span> <a class="code" href="classu_stream_lib_1_1_config_table.html">ConfigTable</a> {
00048         <span class="keyword">public</span>:
<a name="l00053"></a><a class="code" href="classu_stream_lib_1_1_block.html#w41">00053</a>                 <span class="keyword">enum</span> BlockType { 
00054                 TYPE_SOURCE = 1, 
00055                 TYPE_FILTER = 2, 
00056                 TYPE_SINK = 3 };
00057 
<a name="l00062"></a><a class="code" href="classu_stream_lib_1_1_block.html#w42">00062</a>                 <span class="keyword">enum</span> ActionID { 
00063                 ACTION_DATA_PRODUCE = 0,
00065                 ACTION_DATA_CONSUME = 1,
00067                 ACTION_DATA_FILTER = 2, 
00068                 ACTION_LAST_USED_ID = 3, 
00069                 ACTION_MAX_ID = 10 };
00070 
<a name="l00077"></a><a class="code" href="classu_stream_lib_1_1_block.html#w43">00077</a>                 <span class="keyword">enum</span> EventID { 
00078                 EVENT_RESET = 0, 
00079                 EVENT_START = 1, 
00080                 EVENT_STOP = 2, 
00081                 EVENT_PAUSE = 3, 
00082                 EVENT_BUFFERIZE = 4, 
00083                 EVENT_SEEK = 5, 
00084                 EVENT_TELL = 6, 
00085                 EVENT_SKIP = 7, 
00086                 EVENT_QUIT = 8, 
00087                 EVENT_DATA_READY = 9, 
00088                 EVENT_TIMEOUT = 10, 
00089                 EVENT_TERMINATE = 11, 
00090                 EVENT_COMMAND = 12, 
00091                 EVENT_LAST_USED_ID = 13, 
00092                 EVENT_MAX_ID = 20 };
00093 
<a name="l00100"></a><a class="code" href="classu_stream_lib_1_1_block.html#w44">00100</a>                 <span class="keyword">enum</span> StatusID { 
00101                 STATUS_READY = 0, 
00102                 STATUS_STARTED = 1, 
00103                 STATUS_STOPPED = 2, 
00104                 STATUS_PAUSED = 3, 
00105                 STATUS_SEEKING = 4, 
00106                 STATUS_SKIPPING = 5, 
00107                 STATUS_BUFFERIZING = 6, 
00108                 STATUS_RESETTING = 7, 
00109                 STATUS_QUITTING = 8, 
00110                 STATUS_TERMINATING = 9, 
00111                 STATUS_TELLING = 10, 
00112                 STATUS_ERROR = 11 };
00113 
<a name="l00117"></a><a class="code" href="classu_stream_lib_1_1_block.html#w45">00117</a>                 <span class="keyword">enum</span> HandlerTableSize { 
00118                 ACTION_HANDLERS_TABLE_SIZE = ACTION_MAX_ID,
00120                 EVENT_HANDLERS_TABLE_SIZE = EVENT_MAX_ID };
00121 
<a name="l00125"></a><a class="code" href="classu_stream_lib_1_1_block.html#w46">00125</a>                 <span class="keyword">enum</span> ExecHandlerReturnValue { HANDLER_UNDEFINED = -1 };
00126 
<a name="l00130"></a><a class="code" href="classu_stream_lib_1_1_block.html#w47">00130</a>                 <span class="keyword">enum</span> LockTableID { 
00131                 INPUT_TABLE = 1, 
00132                 OUTPUT_TABLE = 2, 
00133                 ALL_TABLES = 3 };
00134 
00138                 Block(<span class="keywordtype">void</span>);
00139 
00143                 <span class="keyword">virtual</span> ~Block(<span class="keywordtype">void</span>);
00144 
00148                 <span class="keywordtype">void</span> destroyPins(<span class="keywordtype">void</span>);
00149 
00153                 <span class="keywordtype">void</span> destroyHandlers(<span class="keywordtype">void</span>);
00154 
<a name="l00159"></a><a class="code" href="classu_stream_lib_1_1_block.html#a4">00159</a>                 <a class="code" href="classu_stream_lib_1_1_control_pin.html">ControlPin</a>* getControlPin(<span class="keywordtype">void</span>)
00160                 {
00161                         <span class="keywordflow">return</span> &amp;_cp;
00162                 }
00163 
<a name="l00170"></a><a class="code" href="classu_stream_lib_1_1_block.html#a5">00170</a>                 <span class="keyword">virtual</span> <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> getType(<span class="keywordtype">void</span>)
00171                 {
00172                         <span class="keywordflow">return</span> FAILURE;
00173                 }
00174 
00187                 <a class="code" href="classu_stream_lib_1_1_data_pin.html">DataPin</a>* createDataPin(<span class="keywordtype">char</span>* name, uint8 dir, uint32 bufsz,
00188                         uint32 bufco, int32 queuesz);
00189 
<a name="l00195"></a><a class="code" href="classu_stream_lib_1_1_block.html#a7">00195</a>                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> delInputPin(<span class="keywordtype">char</span>* pin_name)
00196                 {
00197                         <span class="keywordflow">return</span> _idp.del(pin_name);
00198                 }
00199 
<a name="l00205"></a><a class="code" href="classu_stream_lib_1_1_block.html#a8">00205</a>                 <a class="code" href="classu_stream_lib_1_1_enumeration.html">Enumeration</a>* getInputPins(<span class="keywordtype">void</span>)
00206                 {
00207                         <span class="keywordflow">return</span> _idp.values();
00208                 }
00209 
<a name="l00215"></a><a class="code" href="classu_stream_lib_1_1_block.html#a9">00215</a>                 <a class="code" href="classu_stream_lib_1_1_data_pin.html">DataPin</a>* getInputPin(<span class="keywordtype">char</span>* name)
00216                 {
00217                         <span class="keywordflow">return</span> (<a class="code" href="classu_stream_lib_1_1_data_pin.html">DataPin</a> *) _idp.get(name);
00218                 }
00219 
00225                 <span class="keywordtype">bool</span> belongs(<a class="code" href="classu_stream_lib_1_1_pin.html">Pin</a>* p);
00226 
<a name="l00232"></a><a class="code" href="classu_stream_lib_1_1_block.html#a11">00232</a>                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> delOutputPin(<span class="keywordtype">char</span>* pin_name)
00233                 {
00234                         <span class="keywordflow">return</span> _odp.del(pin_name);
00235                 }
00236 
<a name="l00241"></a><a class="code" href="classu_stream_lib_1_1_block.html#a12">00241</a>                 <a class="code" href="classu_stream_lib_1_1_enumeration.html">Enumeration</a>* getOutputPins(<span class="keywordtype">void</span>)
00242                 {
00243                         <span class="keywordflow">return</span> _odp.values();
00244                 }
00245 
<a name="l00251"></a><a class="code" href="classu_stream_lib_1_1_block.html#a13">00251</a>                 <a class="code" href="classu_stream_lib_1_1_data_pin.html">DataPin</a>* getOutputPin(<span class="keywordtype">char</span>* name)
00252                 {
00253                         <span class="keywordflow">return</span> (<a class="code" href="classu_stream_lib_1_1_data_pin.html">DataPin</a> *) _odp.get(name);
00254                 }
00255 
00263                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> notifyPeersOf(<a class="code" href="classu_stream_lib_1_1_data_pin.html">DataPin</a>* dp);
00264 
00275                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> sendMessageToPeersOf(<a class="code" href="classu_stream_lib_1_1_data_pin.html">DataPin</a>* dp, uint32 code);
00276 
00288                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> attachEventHandler(int32 event_id, <a class="code" href="classu_stream_lib_1_1_block_handler.html">BlockHandler</a>* handler);
00289 
00296                 <a class="code" href="classu_stream_lib_1_1_block_handler.html">BlockHandler</a>* detachEventHandler(int32 event_id);
00297 
00310                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> attachActionHandler(int32 action_id, <a class="code" href="classu_stream_lib_1_1_block_handler.html">BlockHandler</a>* handler);
00311 
00318                 <a class="code" href="classu_stream_lib_1_1_block_handler.html">BlockHandler</a>* detachActionHandler(int32 action_id);
00319 
00325                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> executeEventHandler(int32 event_id);
00326 
00332                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> executeActionHandler(int32 action_id);
00333 
<a name="l00338"></a><a class="code" href="classu_stream_lib_1_1_block.html#a22">00338</a>                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> getStatus(<span class="keywordtype">void</span>)
00339                 {
00340                         <span class="keywordflow">return</span> _status.get();
00341                 }
00342 
<a name="l00347"></a><a class="code" href="classu_stream_lib_1_1_block.html#a23">00347</a>                 <span class="keywordtype">void</span> setStatus(int32 status)
00348                 {
00349                         _status = status;
00350                 }
00351 
00357                 <span class="keyword">static</span> <span class="keywordtype">char</span>* getTypeString(int32 type_id);
00358 
00363                 <span class="keyword">static</span> <span class="keywordtype">char</span>* getStatusString(int32 status);
00364 
00373                 <span class="keyword">static</span> <span class="keywordtype">char</span>** getCommandStrings(uint32* cmd_count);
00374 
<a name="l00379"></a><a class="code" href="classu_stream_lib_1_1_block.html#a24">00379</a>                 <a class="code" href="classu_stream_lib_1_1_block_manager.html">BlockManager</a>* getBlockManager(<span class="keywordtype">void</span>)
00380                 {
00381                         <span class="keywordflow">return</span> _bm;
00382                 }
00383 
<a name="l00388"></a><a class="code" href="classu_stream_lib_1_1_block.html#a25">00388</a>                 <span class="keywordtype">void</span> setSeekInfo(<a class="code" href="structu_stream_lib_1_1seekinfo__t.html">seekinfo</a>* si)
00389                 {
00390                         memcpy(&amp;_seekinfo, si, <span class="keyword">sizeof</span>(_seekinfo));
00391                 }
00392 
<a name="l00399"></a><a class="code" href="classu_stream_lib_1_1_block.html#a26">00399</a>                 <a class="code" href="structu_stream_lib_1_1seekinfo__t.html">seekinfo</a>* getSeekInfo(<span class="keywordtype">void</span>)
00400                 {
00401                         <span class="keywordflow">return</span> &amp;_seekinfo;
00402                 }
00403 
<a name="l00408"></a><a class="code" href="classu_stream_lib_1_1_block.html#a27">00408</a>                 <span class="keywordtype">char</span>* getInfo(<span class="keywordtype">void</span>)
00409                 {
00410                         <span class="keywordflow">return</span> _info.get();
00411                 }
00412 
<a name="l00417"></a><a class="code" href="classu_stream_lib_1_1_block.html#a28">00417</a>                 <span class="keywordtype">void</span> setInfo(<span class="keywordtype">char</span>* info)
00418                 {
00419                         _info = info;
00420                 }
00421 
<a name="l00426"></a><a class="code" href="classu_stream_lib_1_1_block.html#a29">00426</a>                 <span class="keywordtype">char</span>* <a class="code" href="classu_stream_lib_1_1_object.html#a5">getErrorString</a>(<span class="keywordtype">void</span>)
00427                 {
00428                         <span class="keywordflow">return</span> _errorstring.get();
00429                 }
00430 
<a name="l00437"></a><a class="code" href="classu_stream_lib_1_1_block.html#a30">00437</a>                 <span class="keywordtype">void</span> setErrorString(<span class="keywordtype">char</span>* error)
00438                 {
00439                         _errorstring = error;
00440                 }
00441 
00448                 <span class="keywordtype">void</span> lockTable(int32 what);
00449 
00454                 <span class="keywordtype">void</span> unlockTable(int32 what);
00455 
00460                 <span class="keywordtype">char</span>* toString(<span class="keywordtype">void</span>);
00461 
00462         <span class="keyword">protected</span>:
00463                 <span class="comment">/*</span>
00464 <span class="comment">                 * Other constructors protected.</span>
00465 <span class="comment">                 */</span>
<a name="l00466"></a><a class="code" href="classu_stream_lib_1_1_block.html#b0">00466</a>                 Block(Block&amp;)
00467                 {
00468                 }
00469 
00482                 <a class="code" href="namespaceu_stream_lib.html#a244">int32</a> <a class="code" href="classu_stream_lib_1_1_config_table.html#a2">init</a>(<a class="code" href="classu_stream_lib_1_1_block_manager.html">BlockManager</a>* bm, <span class="comment">// pointer to block manager</span>
00483                         <span class="keywordtype">char</span>* name, <span class="comment">// descriptive name</span>
00484                         uint32 bufsz = US_CP_BUFSZ, <span class="comment">// control pin's preferred buffer size</span>
00485                         uint32 bufcount = US_CP_BUFCO, <span class="comment">// control pin's preferred buffer count</span>
00486                         int32 queuesz = US_CP_QUEUESZ  <span class="comment">// control pin's queue size</span>
00487                 );
00488 
00489         <span class="keyword">private</span>:
00490                 <span class="comment">/* static storage for command strings */</span>
00491                 <span class="keyword">static</span> <span class="keywordtype">char</span>* _cmdstrings[EVENT_HANDLERS_TABLE_SIZE];
00492 
00493                 <span class="comment">/* block manager pointer */</span>
00494                 <a class="code" href="classu_stream_lib_1_1_block_manager.html">BlockManager</a>* _bm;
00495 
00496                 <span class="comment">/* the control pin */</span>
00497                 <a class="code" href="classu_stream_lib_1_1_control_pin.html">ControlPin</a> _cp;
00498 
00499                 <span class="comment">/* input data pins table */</span>
00500                 <a class="code" href="classu_stream_lib_1_1_shared_hash.html">SharedHash</a> _idp;
00501 
00502                 <span class="comment">/* output data pins table */</span>
00503                 <a class="code" href="classu_stream_lib_1_1_shared_hash.html">SharedHash</a> _odp;
00504 
00505                 <span class="comment">/* databuf for toString() processing */</span>
00506                 <a class="code" href="classu_stream_lib_1_1_data_buf.html">DataBuf</a> _tostring;
00507 
00508                 <span class="comment">/* table of registered event handlers */</span>
00509                 <a class="code" href="classu_stream_lib_1_1_block_handler.html">BlockHandler</a>* _etable[EVENT_HANDLERS_TABLE_SIZE];
00510 
00511                 <span class="comment">/* table of registered action handlers */</span>
00512                 <a class="code" href="classu_stream_lib_1_1_block_handler.html">BlockHandler</a>* _atable[ACTION_HANDLERS_TABLE_SIZE];
00513 
00514                 <span class="comment">/* handler and action mutex */</span>
00515                 <a class="code" href="classu_stream_lib_1_1_mutex.html">Mutex</a> _mutexTable;
00516 
00517                 <span class="comment">/* seek info */</span>
00518                 <a class="code" href="structu_stream_lib_1_1seekinfo__t.html">seekinfo</a> _seekinfo;
00519 
00520                 <span class="comment">/* status */</span>
00521                 <a class="code" href="classu_stream_lib_1_1_shared_int.html">SharedInt</a> _status;
00522 
00523                 <span class="comment">/* general descriptive info (fixed size) */</span>
00524                 <a class="code" href="classu_stream_lib_1_1_shared_string.html">SharedString</a> _info;
00525 
00526                 <span class="comment">/* error string (fixed size) */</span>
00527                 <a class="code" href="classu_stream_lib_1_1_shared_string.html">SharedString</a> _errorstring;
00528         };
00529 }
00530 
00531 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Feb 9 19:03:32 2006 for uStream by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
